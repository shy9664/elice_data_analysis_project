{% extends 'base.html' %}

{% block content %}
<form>
    아이디 :
    <input type="text" id='user_id' name="user_id" autocomplete="on"/> 
    비밀번호 :
    <input type="password" id='user_pw' name="user_pw" autocomplete='off'/>
    <button onclick="Login(event)">로그인</button>
</form>
{% endblock %}  

{% block scripts %}
<script>
    function Login(event) {
        event.preventDefault()
        let user_id = $("#user_id").val();
        let user_pw = $("#user_pw").val();
        $.ajax({
            type:"POST",
            url:"/login",
            data: {
                user_id: user_id,
                user_pw: user_pw
            },
            success: function(response) {
                if (response.result == "success") {
                    document.cookie=`user_name=${response.user_name}; domain=localhost; path=/;`
                    document.cookie=`user_id=${response.user_id}; domain=localhost; path=/;`
                    document.cookie=`csrf_access_token=${response.csrf_access_token}`
                    window.location.href = '/';
                    alert('로그인 성공')
                } else {
                    window.location.reload()
                    alert('아이디와 비밀번호를 다시 확인해주세요');
                }
            },
            error: function(){
                window.location.reload()
                alert('로그인 실패')
            }
        });
    }
</script>
{% endblock %}